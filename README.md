# JavaScript Test Project

## Setup Instructions

### 1. Environment Variables (`.env`)

Create a `.env` file in the root of your project. Here is an example you can copy:

```env
API_PORT=3000

# Contentful
CONTENTFUL_SPACE_ID=bbd24zg4yngm
CONTENTFUL_ACCESS_TOKEN=your_access_token # copy from js test pdf
CONTENTFUL_ENVIRONMENT=master

# MongoDB
MONGODB_URI=mongodb://mongo:27017/js-test

# JWT
JWT_SECRET=your_jwt_secret
```

**Edit these values to match your actual credentials and environment.**

---

### 2. Running the App with Docker Compose

Make sure you have [Docker](https://www.docker.com/) and [Docker Compose](https://docs.docker.com/compose/) installed.

Start the app and MongoDB with:

```sh
docker-compose up --build
```

This will:
- Build the Node.js app image
- Start MongoDB
- Start the app and connect to MongoDB using the `MONGODB_URI` from your `.env`

---

### 3. Running Tests with Coverage

To run all tests and see coverage, use:

```sh
npm run test:cov
```

This will output a coverage summary in the terminal and generate a `coverage/` folder.

---

### 4. How the Sync Service Works

- **On server startup**, the sync service fetches all products from Contentful and upserts them into MongoDB.
- **Every hour** (configurable via cron), it repeats this sync to keep your database up to date.
- **Pagination** is handled automatically to fetch all products, regardless of how many exist in Contentful.
- **Soft-deleted products** in your database are not restored by the sync, even if they exist in Contentful.

---

### 5. How to Generate a JWT

To get a JWT for authenticated endpoints:

1. Make a POST request to `/auth/login` with a JSON body:
    ```json
    {
      "username": "test",
      "password": "test"
    }
    ```
2. The response will be:
    ```json
    {
      "access_token": "your.jwt.token"
    }
    ```
3. Use this token as a Bearer token in the `Authorization` header for protected endpoints:
    ```
    Authorization: Bearer your.jwt.token
    ```

---

### 6. How to Check the Swagger Docs

After starting the application, you can view the interactive API documentation generated by Swagger at:

```
http://localhost:3000/api
```

- Open this URL in your browser.
- You will see all available endpoints, their parameters, and example responses.
- You can also try out requests directly from the Swagger UI.

**Note:**
If you changed the port or Swagger path, adjust the URL accordingly.

---

## Endpoints

- **Authentication**
  - `POST /auth/login` — Get JWT token

- **Products**
  - `GET /products` — List all products (pagination: 5 per page, filter by name, category, price range)
    - Query params: `page`, `name`, `category`, `minPrice`, `maxPrice`
  - `DELETE /products/:id` — Delete a product

- **Reports** (JWT required)
  - `GET /report/deleted-percentage` — Get percentage of deleted products
  - `GET /report/non-deleted-percentage` — Get percentage of non-deleted products
    - Query params:
      - `withPrice` (`true`/`false`): filter by presence of price
      - `startDate`, `endDate`: filter by creation date range (ISO format)
  - `GET /report/stock-summary` — Get stock summary for products
    - Query params: `minStock`, `maxStock`, `category`

---

## Notes

- The sync service runs **once at startup** and then **every hour** (by default).
- Soft-deleted products are **never restored** by the sync, even if they exist in Contentful.
- All sensitive configuration is managed via the `.env` file.
- Use the JWT token for all `/report` endpoints by setting the `Authorization` header.

---

## Gen AI Usage

During the development of this project, I used generative AI for the following tasks:
1. Help on unit test creation.
2. Help on elaborating the README documentation.
3. Help on setting up Mongoose.
4. Help on setting up authentication.

---

**For any issues, check your `.env` values and Docker logs.**
